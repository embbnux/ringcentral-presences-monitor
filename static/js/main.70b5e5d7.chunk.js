(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{103:function(e,t,n){},123:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(8),i=n.n(c),o=n(62),s=n.n(o),u=n(5),l=n.n(u),p=n(10),f=n(63),m=n(64),d=function(){function e(t){Object(f.a)(this,e),this._sdk=t,this._platform=t.platform(),this._deviceId=null}return Object(m.a)(e,[{key:"checkLogin",value:function(){var e=Object(p.a)(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._platform.loggedIn();case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"gotologinPage",value:function(){var e=Object(p.a)(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this._platform.loginUrl(),window.location.assign(t);case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"loginFromCodeQuery",value:function(){var e=Object(p.a)(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this._platform.parseLoginRedirect(window.location.search)).code){e.next=5;break}return e.next=4,this._platform.login(t);case 4:return e.abrupt("return",!0);case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=Object(p.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._sdk.platform().logout();case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"createSubscription",value:function(){var e=Object(p.a)(l.a.mark(function e(){var t,n,a,r=this,c=arguments;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.length>0&&void 0!==c[0]?c[0]:[],"subscribeKey",n=this._sdk.createSubscription(),a=this._sdk.cache().getItem("subscribeKey"))try{n.setSubscription(a)}catch(i){console.error("Cannot set subscription data",i)}else n.setEventFilters(t);return this._subscription=n,n.on([n.events.subscribeSuccess,n.events.renewSuccess],function(){r._sdk.cache().setItem("subscribeKey",n.subscription())}),e.prev=7,e.next=10,n.register();case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(7),console.error("Cannot register subscription",e.t0);case 15:return e.abrupt("return",n);case 16:case"end":return e.stop()}},e,this,[[7,12]])}));return function(){return e.apply(this,arguments)}}()},{key:"loadPresences",value:function(){var e=Object(p.a)(l.a.mark(function e(){var t,n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._platform.get("/account/~/presence?detailedTelephonyState=true");case 2:return t=e.sent,n=t.json(),e.abrupt("return",n.records);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"loadDevices",value:function(){var e=Object(p.a)(l.a.mark(function e(){var t,n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._platform.get("/account/~/extension/~/device");case 2:return t=e.sent,n=t.json().records,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"superviseCall",value:function(){var e=Object(p.a)(l.a.mark(function e(t,n){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._deviceId){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this._platform.post("/account/~/telephony/sessions/".concat(t.telephonySessionId,"/supervise"),{mode:"Listen",extensionNumber:n,deviceId:this._deviceId});case 4:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"endCall",value:function(){var e=Object(p.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._platform.delete("/account/~/telephony/sessions/".concat(t.telephonySessionId));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setDeviceId",value:function(e){this._deviceId=e}},{key:"subscription",get:function(){return this._subscription}},{key:"platform",get:function(){return this._platform}},{key:"ownerId",get:function(){return this._platform.auth().data().owner_id}}]),e}(),h=(n(103),n(17)),v=n(167),b=n(157),g=n(168),E=n(155),w=n(166),x=n(153),y=n(65),k=n.n(y)()({storageOptions:{name:"call-supervise-data"}}),C=n(154),O=n(156),j=Object(x.a)(function(e){return{heroContent:{backgroundColor:e.palette.background.paper,padding:e.spacing(8,0,6)},heroButtons:{marginTop:e.spacing(4)}}});var S=function(e){var t=e.onLogin,n=j();return r.a.createElement("div",{className:n.heroContent},r.a.createElement(C.a,{maxWidth:"sm"},r.a.createElement(E.a,{component:"h1",variant:"h2",align:"center",color:"textPrimary",gutterBottom:!0},"Presences Monitor"),r.a.createElement(E.a,{variant:"h5",align:"center",color:"textSecondary",paragraph:!0},"A app for admin to  supervise calls under their RingCentral account."),r.a.createElement("div",{className:n.heroButtons},r.a.createElement(O.a,{container:!0,spacing:2,justify:"center"},r.a.createElement(O.a,{item:!0},r.a.createElement(b.a,{variant:"contained",color:"primary",onClick:t},"Login with RingCentral account"))))))},I=n(49),_=n(159),N=n(163),D=n(162),P=n(160),T=n(161),L=n(67),B=n.n(L),Q=n(165),R=n(169),F=n(164),W=Object(x.a)(function(e){return{modalContent:{position:"absolute",width:800,backgroundColor:e.palette.background.paper,boxShadow:e.shadows[5],padding:e.spacing(4),outline:"none"},table:{minWidth:800}}});function A(){return{top:"".concat(50,"%"),left:"".concat(50,"%"),transform:"translate(-".concat(50,"%, -").concat(50,"%)")}}var K=function(e){var t=e.opened,n=e.presence,a=e.onClose,c=e.superviseCall,i=e.endCall,o=r.a.useState(A),s=Object(h.a)(o,1)[0],u=W();return r.a.createElement(R.a,{open:t,onClose:a},r.a.createElement("div",{className:u.modalContent,style:s},r.a.createElement(E.a,{variant:"h6"},n.extension&&n.extension.extensionNumber," | ",n.telephonyStatus),r.a.createElement(E.a,{variant:"h6"},"Calls:"),r.a.createElement(_.a,{className:u.table,size:"small"},r.a.createElement(P.a,null,r.a.createElement(T.a,null,r.a.createElement(D.a,null,"Direction"),r.a.createElement(D.a,{align:"right"},"Telephony Status"),r.a.createElement(D.a,{align:"right"},"From"),r.a.createElement(D.a,{align:"right"},"To"),r.a.createElement(D.a,{align:"right"},"Start Time"),r.a.createElement(D.a,{align:"right"},"Operation"))),r.a.createElement(N.a,null,n.activeCalls&&n.activeCalls.filter(function(e){return"NoCall"!==e.telephonyStatus}).map(function(e){return r.a.createElement(T.a,{key:e.id},r.a.createElement(D.a,{component:"th",scope:"row"},e.direction),r.a.createElement(D.a,{align:"right"},e.telephonyStatus),r.a.createElement(D.a,{align:"right"},e.from),r.a.createElement(D.a,{align:"right"},e.to),r.a.createElement(D.a,{align:"right"},e.startTime),r.a.createElement(D.a,{align:"right"},r.a.createElement(F.a,{size:"small","aria-label":"Small outlined contained primary button group"},r.a.createElement(b.a,{onClick:function(){return i(e)}},"End"),r.a.createElement(b.a,{onClick:function(){return c(e,n.extension.extensionNumber)}},"Supervise"))))})))))},J=Object(x.a)(function(e){return{container:{paddingTop:"20px"},table:{minWidth:650},tr:{"&:hover":{background:"#f3f3f3",cursor:"pointer"}}}}),M=[];var z=function(e){var t=e.ownerId,n=e.loadPresences,c=e.subscription,i=e.superviseCall,o=e.endCall,s=J(),u=k("".concat(t,"-presencesData"),M),f=Object(h.a)(u,2),m=f[0],d=f[1],v=Object(a.useState)({}),b=Object(h.a)(v,2),g=b[0],E=b[1],w=Object(a.useState)(!1),x=Object(h.a)(w,2),y=x[0],O=x[1];return Object(a.useEffect)(function(){if(c){var e=function(e){var t=[].concat(m),n=t.findIndex(function(t){return t.extension.id===e.body.extensionId});n>-1&&(t[n]=Object(I.a)({},t[n],e.body,{activeCalls:e.body.activeCalls&&e.body.activeCalls.filter(function(e){return"NoCall"!==e.telephonyStatus})}),d(t)),g.extension&&g.extension.id===e.body.extensionId&&E(Object(I.a)({},g,e.body))};return c.on(c.events.notification,e),function(){c.removeListener(c.events.notification,e)}}},[c,m,g]),Object(a.useEffect)(function(){function e(){return(e=Object(p.a)(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(m!==M){e.next=5;break}return e.next=3,n();case 3:t=e.sent,d(t);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}!function(){e.apply(this,arguments)}()},[m]),r.a.createElement(C.a,{maxWidth:"md",component:"main",className:s.container},r.a.createElement(Q.a,{color:"primary","aria-label":"Refresh",onClick:Object(p.a)(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return d([]),e.next=3,n();case 3:t=e.sent,d(t);case 5:case"end":return e.stop()}},e)}))},r.a.createElement(B.a,null)),r.a.createElement(_.a,{className:s.table},r.a.createElement(P.a,null,r.a.createElement(T.a,null,r.a.createElement(D.a,null,"Extension"),r.a.createElement(D.a,{align:"right"},"Presence Status"),r.a.createElement(D.a,{align:"right"},"Telephony Status"),r.a.createElement(D.a,{align:"right"},"Dnd Status"),r.a.createElement(D.a,{align:"right"},"Active Calls"))),r.a.createElement(N.a,null,m.map(function(e){return r.a.createElement(T.a,{key:e.extension.id,className:s.tr,onClick:function(){E(e),O(!0)}},r.a.createElement(D.a,{component:"th",scope:"row"},e.extension.extensionNumber),r.a.createElement(D.a,{align:"right"},e.presenceStatus),r.a.createElement(D.a,{align:"right"},e.telephonyStatus),r.a.createElement(D.a,{align:"right"},e.dndStatus),r.a.createElement(D.a,{align:"right"},e.activeCalls&&e.activeCalls.length||0))}))),r.a.createElement(K,{opened:y,onClose:function(){O(!1)},presence:g,superviseCall:i,endCall:o}))},G=n(170),U=n(172);function V(e){var t=e.loadDevices,n=e.ownerId,c=e.onDeviceIdChanged,i=Object(a.useState)(null),o=Object(h.a)(i,2),s=o[0],u=o[1],f=Object(a.useState)([]),m=Object(h.a)(f,2),d=m[0],v=m[1],g=k("".concat(n,"-deviceId"),null),E=Object(h.a)(g,2),w=E[0],x=E[1],y=function(){var e=Object(p.a)(l.a.mark(function e(){var n,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t();case 2:n=e.sent,a=n.filter(function(e){return"Online"===e.status}),v(a),!a.find(function(e){return e.id===w})&&a.length?(x(a[0].id),c(a[0].id)):c(w);case 7:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();function C(){u(null)}Object(a.useEffect)(function(){y()},[]);var O=d.find(function(e){return e.id===w});return r.a.createElement(r.a.Fragment,null,r.a.createElement(b.a,{color:"inherit","aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){u(e.currentTarget)},title:"Select devices"},O&&O.name||"Select device"),r.a.createElement(G.a,{id:"simple-menu",anchorEl:s,keepMounted:!0,open:Boolean(s),onClose:C},d.map(function(e){return r.a.createElement(U.a,{key:e.id,onClick:function(){C(),x(e.id),c(e.id)}},e.name," - ",e.computerName)})))}var H=Object(x.a)(function(e){return{root:{flexGrow:1},center:{display:"flex",flexDirection:"column",alignItems:"center"},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}}});var Z=function(e){var t=e.client,n=H(),c=Object(a.useState)(!1),i=Object(h.a)(c,2),o=i[0],s=i[1],u=k("authState",!1),f=Object(h.a)(u,2),m=f[0],d=f[1],x=Object(a.useState)(null),y=Object(h.a)(x,2),C=(y[0],y[1]);Object(a.useEffect)(function(){function e(){return(e=Object(p.a)(l.a.mark(function e(){var n,a,r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.checkLogin();case 2:if(n=e.sent,d(n),!n){e.next=13;break}return a=function(){d(!1)},t.platform.on(t.platform.events.refreshError,a),e.next=9,t.createSubscription(["/account/~/presence?detailedTelephonyState=true"]);case 9:return r=e.sent,C(r),s(!0),e.abrupt("return",function(){t.platform.removeListener(t.platform.events.refreshError,a)});case 13:if(-1!==window.location.search.indexOf("code=")){e.next=16;break}return s(!0),e.abrupt("return");case 16:return e.next=18,t.loginFromCodeQuery();case 18:e.sent&&window.location.assign("https://embbnux.github.io/ringcentral-presences-monitor");case 20:case"end":return e.stop()}},e)}))).apply(this,arguments)}!function(){e.apply(this,arguments)}()},[]);var O=null;O=o?m?r.a.createElement(z,{loadPresences:Object(p.a)(l.a.mark(function e(){var n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.loadPresences();case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},e)})),superviseCall:function(){var e=Object(p.a)(l.a.mark(function e(n,a){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.superviseCall(n,a);case 2:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),endCall:function(){var e=Object(p.a)(l.a.mark(function e(n){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.endCall(n);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),subscription:t.subscription,ownerId:t.ownerId}):r.a.createElement(S,{onLogin:function(){t.gotologinPage()}}):r.a.createElement("div",{className:n.center},r.a.createElement(w.a,null));var j=m?r.a.createElement(b.a,{color:"inherit",onClick:function(){d(!1),t.logout()}},"Logout"):null,I=m?r.a.createElement(V,{loadDevices:Object(p.a)(l.a.mark(function e(){var n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.loadDevices();case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},e)})),onDeviceIdChanged:function(e){return t.setDeviceId(e)},ownerId:t.ownerId}):null;return r.a.createElement(r.a.Fragment,null,r.a.createElement(v.a,{position:"static"},r.a.createElement(g.a,null,r.a.createElement(E.a,{variant:"h6",className:n.title},"RingCentral Presences Monitor"),I,j)),O)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var $=new s.a({server:"https://platform.ringcentral.com",appKey:"bobEybMvSzGl2HlpKm1J2A",appSecret:"VOAQuhpbRP2AmQCgd-mZJgBardV2N4TQ-3-jbd5shQcQ",redirectUri:"https://embbnux.github.io/ringcentral-presences-monitor"});window.ringcentralClient=new d($),i.a.render(r.a.createElement(Z,{client:window.ringcentralClient}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},78:function(e,t,n){e.exports=n(123)}},[[78,1,2]]]);
//# sourceMappingURL=main.70b5e5d7.chunk.js.map